---
title:  "[Node.js] - socket.io ì‚´í´ë³´ê¸°"
search: true
toc : true
toc_label : ë„¤ë¹„ê²Œì´ì…˜
header:
  teaser: "/assets/images/header/socket_io.png"
toc_sticky : true
tag:
  - ë„¤íŠ¸ì›Œí¬
  - ì›¹
  - node.js
  - socket.io
categories:
  - Node.js
excerpt: "socket.io í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ëŠë‚€ ì  ì†Œê°œ"
last_modified_at: 2020-03-18T08:06:00-05:00
---
<img src = "/assets/images/header/socket_io.png"/>   

ë„¤íŠ¸ì›Œí¬ ê³¼ëª© ë•Œë¬¸ì— ì†ì„ ëŒ€ê²Œ ëœ ì†Œì¼“ í†µì‹ .


ì•„ë¬´ë˜ë„ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•˜ë‹¤ ë³´ë‹ˆ ì €ì ˆë¡œ node.jsì— ê´€ì‹¬ì´ ìƒê¸°ê²Œ ë˜ì—ˆëŠ”ë°, ë§ì€ ì‚¬ëŒë“¤ì´ `socket.io` ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ì•„ ì•Œì•„ë³´ê²Œ ë˜ì—ˆë‹¤.

[socket.io](https://socket.io/) ì‚¬ì´íŠ¸ì—ì„œëŠ” ì±„íŒ… ì–´í”Œë¦¬ì¼€ì´ì…˜ ì œì‘ íŠœí† ë¦¬ì–¼ì„ í†µí•´ `socket.io` í”„ë ˆì„ì›Œí¬ë¥¼ ì†Œê°œí•˜ëŠ”ë°, íŠœí† ë¦¬ì–¼ë§Œìœ¼ë¡œëŠ” ì´í•´ê°€ ë˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì´ ë§ì•˜ë‹¤. ğŸ˜±

## 1. `socket.io` íŠœí† ë¦¬ì–¼
> socket.io ì±„íŒ… ì–´í”Œë¦¬ì¼€ì´ì…˜ íŠœí† ë¦¬ì–¼ ì½”ë“œ

```javascript
// index.js (ì„œë²„ ë‹´ë‹¹)

let app = require("express")();
let http = require("http").createServer(app);
let io = require("socket.io")(http);

app.get("/", function(req, res) {
  res.sendFile(__dirname + "/index.html");
});

io.on("connection", function(socket) {
  socket.on("chat message", function(msg) {
    io.emit("chat message", msg);
  });
});

http.listen(3000, function() {
  console.log("listening on 3000");
});
```

```html
// index.html (í´ë¼ì´ì–¸íŠ¸ ë‹´ë‹¹) ì¤‘ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¶€ë¶„
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>
  $(function() {
    var socket = io();
    $("form").submit(function(e) {
      e.preventDefault(); // prevents page reloading
      socket.emit("chat message", $("#m").val());
      $("#m").val("");
      return false;
    });
    socket.on("chat message", function(msg) {
      $("#messages").append($("<li>").text(msg));
    });
  });
</script>
```

ìš°ì„  ìœ„ íŠœí† ë¦¬ì–¼ ì½”ë“œì—ì„œëŠ” ì™œ express ì„œë²„ë¥¼ ì“°ëŠ”ì§€, html ì½”ë“œì— í¬í•¨ëœ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë¬´ìŠ¨ ì—­í• ì„ í•˜ëŠ”ì§€ëŠ” ì„¤ëª…í•´ì£¼ì§€ ì•Šì•„ ì•„ì‰¬ì›€ì´ ë‚¨ì•˜ë‹¤. ğŸ˜‚

ê·¸ë˜ë„ ì°¸ì—¬ì ID ì¶”ê°€í•˜ê¸°, ëˆ„ê°€ íƒ€ìë¥¼ ì¹˜ê³  ìˆëŠ”ì§€ í‘œì‹œí•˜ê¸° ë“± ìˆ˜ë§ì€ ê¸°ëŠ¥ë“¤ì„ ê³¼ì œë¡œ ë‚¨ê²¨ ì£¼ì–´ íŠœí† ë¦¬ì–¼ì„ ë§ˆì¹œ í›„ì—ë„ ìŠ¤ìŠ¤ë¡œ ë°œì „í•  ìˆ˜ ìˆëŠ” ì—¬ì§€ë¥¼ ë‚¨ê²¨ì¤€ ì ì€ ë§¤ìš° ê°ì‚¬í•˜ë‹¤. ğŸ˜Š

> ğŸ‘ íŠœí† ë¦¬ì–¼ ì™„ì„± ê²°ê³¼

<img src = "/assets/images/2020-03-18-socket_io/chatapp.PNG">


## 2. `socket.io` ë³¸ê²© ë‹¤ë¤„ë³´ê¸°

ê³¼ì œë¥¼ ìˆ˜í–‰í•˜ê¸° ì „ `socket.io` ë¥¼ ë” ì•Œì•„ë³´ê³ ì í•œë²ˆ expressì™€ jqueryë¥¼ ê±·ì–´ë‚´ê³  ìœ„ ì½”ë“œë¥¼ í† ëŒ€ë¡œ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì— 'Hello, World!' ë¬¸ìì—´ì„ ì „ì†¡í•˜ëŠ” ê¸°ëŠ¥ë§Œì„ ê°€ì§„ ì½”ë“œë¥¼ ì§œ ë³´ì•˜ë‹¤.
> ì˜ˆì œ ì½”ë“œ

```javascript
const io = require("socket.io");
const server = io.listen(8000);

server.on("connection", socket => {
  console.info(`Client connected [id=${socket.id}]`);
  msg = "hello, world!";
  socket.emit("message-sent", msg);
  socket.on("disconnect", () => {
    console.info(`Client gone [id=${socket.id}]`);
  });
});
```


```javascript
// client.js (í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ)
const io = require("socket.io-client"),
  socket = io.connect("http://localhost:8000");

socket.on("message-sent", msg => {
  console.log(msg);
});
```
ìš°ì„  ì½”ë“œë¥¼ ì§œë©´ì„œ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ë‚¸ ê²ƒì€ `require("socket.io")` ë¥¼ í†µí•´ ì„œë²„ë¥¼ ìƒì„±í•œ ë‹¤ìŒ, í•´ë‹¹ ì„œë²„ì— listen() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì ‘ì†í•  í¬íŠ¸ë¥¼ ì •í•˜ë©´ í•´ë‹¹ í¬íŠ¸ë¥¼ í†µí•´ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤.   

ê·¸ í›„ê°€ ì•½ê°„ ì´í•´í•˜ê¸° ì–´ë ¤ì› ëŠ”ë°, `server.on("connection", socket => {})` ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ì½”ë“œì—ì„œ ê³¼ì—° "connection" ê³¼ socket ì´ ë§¤ê°œë³€ìˆ˜ë¡œì¨ ì–´ë–¤ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ”ì§€ ê¶ê¸ˆí–ˆë‹¤.   

ì•Œì•„ë³¸ ê²°ê³¼ `server.on("connection", callback());` ì˜ "connection" ì€ ìš°ë¦¬ê°€ ì§ì ‘ ì •í•  ìˆ˜ ìˆëŠ” ë§¤ê°œë³€ìˆ˜ê°€ ì•„ë‹Œ `node.js` ì—ì„œ ì•½ì†ëœ ì´ë²¤íŠ¸ ì¤‘ í•˜ë‚˜ë¡œ, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ìƒˆë¡œ ì—°ê²°ë  ë•Œ `emit` ë˜ëŠ” ì´ë²¤íŠ¸ì˜€ë‹¤.
> [node.js connection ì´ë²¤íŠ¸](https://nodejs.org/api/net.html#net_event_connection)

<img src = "/assets/images/2020-03-18-socket_io/connection.PNG">

## 3. `emit` ê³¼ `on` ì‚¬ìš©ë²•
> ì˜ˆì œ ì½”ë“œ

```javascript
// index.js (ì±„íŒ… ì–´í”Œ ì„œë²„ ë¶€ë¶„)
io.on("connection", function(socket) {
  socket.on("chat message", function(msg) {
    io.emit("chat message", msg);
  });
});
```
```javascript
// index.html (ì±„íŒ… ì–´í”Œ í´ë¼ì´ì–¸íŠ¸ ë¶€ë¶„)
socket.emit("chat message", $("#m").val());
socket.on("chat message", function(msg) {
  $("#messages").append($("<li>").text(msg));
  console.log(msg);
});
```
ë˜, ë¶„ëª… "chat-message" ê°™ì€ ì´ë¦„ì€ ì•„ë¬´ë¦¬ ë´ë„ ì‚¬ì „ì— ì •ì˜ëœ ì´ë²¤íŠ¸ëŠ” ì•„ë‹ ê²ƒ ê°™ì•˜ëŠ”ë° ì•Œì•„ë³¸ ê²°ê³¼ `.emit` ê³¼ `.on` ë©”ì„œë“œëŠ” ì„œë¡œ ì¼ì¹˜í•˜ëŠ” ì´ë²¤íŠ¸ ì´ë¦„ì„ ì°¾ì•„ ì§ì„ ì´ë£¬ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

ê·¸ëŸ°ë°, ì½”ë“œë¥¼ ë“¤ì—¬ë‹¤ë³´ .on ê³¼ .emit ë©”ì„œë“œê°€ `io.on` ê³¼ `socket.on`, `io.emit` ê³¼ `socket.emit` ìœ¼ë¡œ ë˜ë‹¤ì‹œ ê°ˆë¼ì§€ëŠ” ê²ƒì´ ëˆˆì— ë³´ì˜€ë‹¤.

ì´ ê¶ê¸ˆì¦ì€ [ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°](https://stackoverflow.com/questions/32674391/io-emit-vs-socket-emit) ë§í¬ì—ì„œ ì–´ëŠì •ë„ í•´ê²°í•  ìˆ˜ ìˆì—ˆëŠ”ë°, ê°„ë‹¨í•˜ê²Œ ìš”ì•½í•´ë³´ë©´ `io` ëŠ” ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” ì„œë²„(ì¦‰, ëª¨ë“  ì†Œì¼“ì„ ì•„ìš°ë¦„) ì´ë©°, `socket` ì€ ê°œë³„ í´ë¼ì´ì–¸íŠ¸ì— í•´ë‹¹í•¨ì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

ì¦‰ ìœ„ ì½”ë“œë¥¼ ë¶„ì„í•´ ë³´ë©´, ëŒ€ëµ ì´ëŸ° íë¦„ì„ ê°€ì§ì„ ì•Œ ìˆ˜ ìˆë‹¤.
<img src = "/assets/images/2020-03-18-socket_io/procedure.PNG">

ì´ì œ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ì–´ë–»ê²Œ í‹°í‚¤íƒ€ì¹´ë¥¼ ë§ì¶”ëŠ”ì§€ê¹Œì§€ëŠ” ì–¼ì¶” ì•Œì•˜ìœ¼ë‹ˆ, ë‹¤ìŒ ê³¼ì œë¡œëŠ” ì±„íŒ… ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ê¸°ëŠ¥ì„ ì¶”ê°€í•´ë³´ë„ë¡ í•´ì•¼ê² ë‹¤. ğŸ˜„
